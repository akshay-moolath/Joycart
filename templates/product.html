<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ product.title if product else "Product" }}</title>

    <!-- CSS -->
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/css/font-awesome.min.css">
    <link rel="stylesheet" href="/static/css/style.css">

    <!-- AUTH CHECK -->
    <script>
        function isTokenExpired(token) {
            try {
                const payload = JSON.parse(atob(token.split('.')[1]));
                const now = Math.floor(Date.now() / 1000);
                return payload.exp <= now;
            } catch (e) {
                return true;
            }
        }

        const token = localStorage.getItem("access_token");
        // Uncomment later if you want auth protection
        /*
        if (!token || isTokenExpired(token)) {
            localStorage.removeItem("access_token");
            window.location.replace("/login");
        }
        */
    </script>
</head>

<body>

{% if product %}

<!-- PRODUCT SECTION -->
<div class="section">
    <div class="container">
        <div class="row">

            <!-- PRODUCT THUMBNAILS -->
            <div class="col-md-2 col-md-pull-5">
                <div id="product-imgs">
                    {% for img in product.images %}
                    <div class="product-preview">
                        <img src="{{ img }}" alt="">
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- PRODUCT MAIN IMAGE -->
            <div class="col-md-5 col-md-push-2">
                <div id="product-main-img">
                    {% for img in product.images %}
                    <div class="product-preview">
                        <img src="{{ img }}" alt="">
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- PRODUCT DETAILS -->
            <div class="col-md-5">
                <div class="product-details">

                    <h2 class="product-name">{{ product.title }}</h2>

                    <div>
                        <h3 class="product-price">
                            â‚¹{{ product.price }}
                        </h3>

                        <span class="product-availability">
                            {{ product.availability }}
                        </span>
                    </div>

                    <p>{{ product.description }}</p>

                    <!-- QUANTITY -->
                    <div class="add-to-cart">
                        <div class="qty-label">
                            Qty
                            <div class="input-number">
                                <input type="number" id="qty" min="1" value="1">
                                <span class="qty-up">+</span>
                                <span class="qty-down">-</span>
                            </div>
                        </div>

                        <!-- ADD TO CART BUTTON -->
                        <button
                            class="add-to-cart-btn"
                            data-product-id="{{ product.id }}">
                            <i class="fa fa-shopping-cart"></i> add to cart
                        </button>
                    </div>

                    <!-- PRODUCT META -->
                    <ul class="product-links">
                        <li>Category:</li>
                        <li>{{ product.category }}</li>
                    </ul>

                </div>
            </div>

        </div>
    </div>
</div>

{% else %}

<div class="container">
    <h3>Product not found</h3>
</div>

{% endif %}

<!-- JS -->
<script src="/static/js/jquery.min.js"></script>
<script src="/static/js/bootstrap.min.js"></script>
<script src="/static/js/main.js"></script>

<!-- ADD TO CART JS (placeholder) -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const btn = document.querySelector(".add-to-cart-btn");
        if (!btn) return;

        btn.addEventListener("click", function () {
            const productId = this.dataset.productId;
            const qty = document.getElementById("qty").value;

            console.log("Add to cart:", productId, qty);

            // Later:
            // fetch("/api/cart/add", { ... })
        });
    });
</script>

</body>
</html>
